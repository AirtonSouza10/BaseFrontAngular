<div class="relatorio-dia">

  <!-- Cabeçalho -->
  <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
    <h2>Buscar Parcelas</h2>
  </div>

  <!-- Campo de busca -->
  <div class="input-pesquisa">
    <input type="text" [(ngModel)]="termo" placeholder="Número parcela, duplicata, fornecedor..." />
    <button (click)="pesquisar()">Buscar</button>
  </div>

  <!-- Mensagem quando não encontrado -->
  <div *ngIf="pesquisado && resultados.length === 0" class="mensagem-vazia">
    Nenhuma parcela encontrada.
  </div>

  <!-- Container da tabela -->
  <div class="table-container" *ngIf="resultados.length > 0">
    <table>
      <thead>
        <tr>
          <th>ID Parcela</th>
          <th>Parcela</th>
          <th>Duplicata</th>
          <th>Fornecedor</th>
          <th>Valor</th>
          <th>Vencimento</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of resultados">
          <td data-label="ID Parcela">{{ p.parcelaId }}</td>
          <td data-label="Parcela">{{ p.numeroParcela || '—' }}</td>
          <td data-label="Duplicata">{{ p.descricaoDuplicata }}</td>
          <td data-label="Fornecedor">{{ p.fornecedorNome }}</td>
          <td data-label="Valor">{{ p.valorTotal | currency:'BRL' }}</td>
          <td data-label="Vencimento">{{ p.dtVencimento | date:'dd/MM/yyyy' }}</td>
          <td>{{ p.status || '—' }}</td>
          <td>
            <button class="btn-baixar" (click)="abrirBaixa(p)">Baixar</button>
            <button class="btn-alterar" (click)="abrirEdicao(p)">Alterar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginação -->
  <div class="paginacao" *ngIf="totalPages > 1">
    <button (click)="paginaAnterior()" [disabled]="pagina === 0">«</button>

    <button *ngFor="let pg of getPaginasVisiveis()"
            (click)="irParaPagina(pg)"
            [class.active]="pg === pagina">
      {{ pg + 1 }}
    </button>

    <button (click)="proximaPagina()" [disabled]="pagina === totalPages - 1">»</button>
  </div>

  <!-- MODAL BAIXA -->
  <div class="modal-backdrop" *ngIf="parcelaSelecionada">
    <div class="modal">
      <h3>Baixar Parcela</h3>
      <app-baixar-parcela [duplicataSelecionada]="parcelaSelecionada"></app-baixar-parcela>
      <button (click)="fecharBaixa()" class="btn-fechar">Fechar</button>
    </div>
  </div>

  <!-- MODAL EDIÇÃO -->
  <div class="modal-backdrop" *ngIf="parcelaEdicao">
    <div class="modal">

      <h3>Alterar Parcela</h3>

      <div class="form-group">
        <label>Número Parcela</label>
        <input [(ngModel)]="form.numeroParcela" />
      </div>

      <div class="form-group">
        <label>Valor Total</label>
        <input type="number" [(ngModel)]="form.valorTotal" />
      </div>

      <div class="form-group">
        <label>Vencimento</label>
        <input type="date" [(ngModel)]="form.dtVencimento" />
      </div>

      <div class="form-group">
        <label>Data de Pagamento</label>
        <input type="date" [(ngModel)]="form.dtPagamento" />
      </div>

      <div class="form-group">
        <label>Observação</label>
        <textarea [(ngModel)]="form.observacao"></textarea>
      </div>

      <div class="form-group">
        <label>Status</label>
        <select [(ngModel)]="form.statusId">
          <option *ngFor="let s of situacoes" [value]="s.id">{{ s.descricao }}</option>
        </select>
      </div>

      <div class="form-group">
        <label>Tipo Pagamento</label>
        <select [(ngModel)]="form.tipoPagamentoId">
          <option *ngFor="let t of tiposPagamento" [value]="t.id">{{ t.descricao }}</option>
        </select>
      </div>

      <button (click)="salvarEdicao()">Salvar</button>
      <button (click)="fecharEdicao()" class="btn-fechar">Cancelar</button>

    </div>
  </div>

</div>
