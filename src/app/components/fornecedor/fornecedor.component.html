<div class="form-container">
  <div style="display: flex; align-items: center; gap: 10px;">
    <h2 style="margin: 0;">Fornecedor</h2>
    <button type="button" class="btn-relatorio" (click)="abrirPDF()">
      <i class="fa-regular fa-file-pdf"></i>
      PDF
    </button>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">

    <!-- ===================== DADOS DO FORNECEDOR ===================== -->
    <div class="form-section">
      <h3>Dados do Fornecedor</h3>
      <div class="form-row">
        <div class="form-group flex-2">
          <label for="nome">Nome<span class="text-danger">*</span></label>
          <input id="nome" formControlName="nome" type="text" maxlength="255" required />
        </div>
        <div class="form-group flex-2">
          <label for="razao">Razão Social</label>
          <input id="razao" formControlName="razao" type="text" maxlength="255" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group flex-1">
          <label for="identificacao">Identificação<span class="text-danger">*</span></label>
          <input id="identificacao" formControlName="identificacao" type="text" maxlength="14" required />
        </div>
        <div class="form-group flex-2">
          <label for="email">Email</label>
          <input id="email" formControlName="email" type="text" maxlength="255" />
        </div>
        <div class="form-group flex-1" style="text-align: center;">
          <label for="ativo">Ativo</label>
          <input id="ativo" type="checkbox" formControlName="ativo" />
        </div>
      </div>
    </div>

    <!-- ===================== TELEFONES ===================== -->
    <div class="form-section">
      <h3>Telefones</h3>
      <div formArrayName="telefones">
        <div *ngFor="let tel of telefones.controls; let i = index" [formGroupName]="i" class="telefone-card">
          <input type="hidden" formControlName="id" />
          <div class="form-row">
            <div class="form-group flex-1">
              <label>Número</label>
              <input type="text" formControlName="numero" placeholder="Número" mask="(00) 0000-00009" required />
            </div>
            <div class="form-group flex-1">
              <label>Tipo</label>
              <select formControlName="tpTelefone" [compareWith]="compareById">
                <option [ngValue]="null">Selecione o tipo</option>
                <option *ngFor="let tipo of tiposTelefone" [ngValue]="tipo">{{tipo.descricao}}</option>
              </select>
            </div>
            <div class="form-group flex-1">
              <label>&nbsp;</label>
              <div class="form-group flex-button">
                <button type="button" class="btn-remove" (click)="removeTelefone(i)">Remover</button>
              </div>
            </div>
          </div>
        </div>
        <button type="button" class="btn-add" (click)="addTelefone()">+ Telefone</button>
      </div>
    </div>

    <!-- ===================== ENDEREÇOS ===================== -->
    <div class="form-section">
      <h3>Endereços</h3>
      <div formArrayName="enderecos">
        <div *ngFor="let end of enderecos.controls; let i = index" [formGroupName]="i" class="endereco-card">
          <input type="hidden" formControlName="id" />
          <div class="form-row">
            <div class="form-group flex-1">
              <label>CEP</label>
              <input type="text" formControlName="cep" placeholder="CEP" (blur)="onCepBlur(i)" />
            </div>
            <div class="form-group flex-3">
              <label>Logradouro</label>
              <input type="text" formControlName="logradouro" placeholder="Logradouro" />
            </div>
            <div class="form-group flex-1">
              <label>Número</label>
              <input type="text" formControlName="numero" placeholder="Número" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group flex-2">
              <label>Complemento</label>
              <input type="text" formControlName="complemento" placeholder="Complemento" />
            </div>
            <div class="form-group flex-2">
              <label>Bairro</label>
              <input type="text" formControlName="bairro" placeholder="Bairro" />
            </div>
            <div class="form-group flex-1">
              <label>Cidade</label>
              <input type="text" formControlName="cidade" placeholder="Cidade" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group flex-1">
              <label>Estado</label>
              <input type="text" formControlName="estado" placeholder="Estado" />
            </div>
            <div class="form-group flex-1">
              <label>UF</label>
              <select formControlName="uf">
                <option value="">Selecione</option>
                <option *ngFor="let uf of ['AC','AL','AP','AM','BA','CE','DF','ES','GO','MA','MT','MS','MG','PA','PB','PR','PE','PI','RJ','RN','RS','RO','RR','SC','SP','SE','TO']" [value]="uf">
                  {{uf}}
                </option>
              </select>
            </div>
            <div class="form-group flex-1">
              <label>Tipo</label>
              <select formControlName="tipoEndereco" [compareWith]="compareById">
                <option [ngValue]="null">Selecione</option>
                <option *ngFor="let tipo of tiposEndereco" [ngValue]="tipo">{{tipo.descricao}}</option>
              </select>
            </div>
          </div>
          <div class="form-group flex-button">
            <button type="button" class="btn-remove" (click)="removeEndereco(i)">Remover</button>
          </div>
          <hr class="divider"/>
        </div>
        <button type="button" class="btn-add" (click)="addEndereco()">+ Endereço</button>
      </div>
    </div>

    <!-- ===================== AÇÕES ===================== -->
    <div class="form-actions">
      <button type="submit" [disabled]="form.invalid" class="btn-submit">
        {{ editando ? 'Atualizar' : 'Salvar' }}
      </button>
      <button *ngIf="editando" type="button" class="btn-remove" (click)="cancelarEdicao()">Cancelar</button>
    </div>
  </form>

  <!-- ===================== MENSAGENS ===================== -->
  <div *ngIf="sucessoMsg" class="mensagem-sucesso">{{ sucessoMsg }}</div>
  <div *ngIf="erroMsg" class="mensagem-erro">{{ erroMsg }}</div>

  <!-- ===================== TABELA ===================== -->
  <table class="tabela-tipos" *ngIf="fornecedores.length">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Identificação</th>
        <th>Ativo</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let f of fornecedores">
        <td>{{ f.nome }}</td>
        <td>{{ f.identificacao }}</td>
        <td>{{ f.ativo ? 'Sim' : 'Não' }}</td>
        <td>
          <button type="button" class="btn-submit" (click)="editarFornecedor(f)">Editar</button>
        </td>
      </tr>
    </tbody>
  </table>
  <!-- ===================== PAGINAÇÃO ===================== -->
  <div class="paginacao" *ngIf="totalPages > 1">
    <button (click)="mudarPagina(currentPage - 1)" [disabled]="currentPage === 0">« Anterior</button>

    <!-- Primeira página -->
    <button *ngIf="currentPage > 2" (click)="mudarPagina(0)">1</button>
    <span *ngIf="currentPage > 3">...</span>

    <!-- Páginas próximas -->
    <ng-container *ngFor="let p of getPaginasVisiveis()">
      <button [class.active]="p === currentPage" (click)="mudarPagina(p)">
        {{ p + 1 }}
      </button>
    </ng-container>

    <span *ngIf="currentPage < totalPages - 4">...</span>
    <!-- Última página -->
    <button *ngIf="currentPage < totalPages - 2" (click)="mudarPagina(totalPages - 1)">
      {{ totalPages }}
    </button>

    <button (click)="mudarPagina(currentPage + 1)" [disabled]="currentPage + 1 >= totalPages">
      Próxima »
    </button>
  </div>

</div>
