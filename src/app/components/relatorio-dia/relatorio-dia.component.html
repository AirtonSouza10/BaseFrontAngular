<div class="relatorio-dia">

  <div style="display: flex; align-items: center; gap: 10px;">
    <h2 style="margin: 0;">Relatorio Diário</h2>
    <button type="button" class="btn-relatorio" (click)="abrirPDF()">
      <i class="fa-regular fa-file-pdf"></i>
      PDF
    </button>
  </div>
  <div class="table-wrapper">
    <div *ngIf="carregandoDia" class="carregando">Carregando...</div>

    <table *ngIf="!carregandoDia && duplicatasDia.length > 0" class="tabela-dia">
      <thead>
        <tr>
          <th>Filial</th>
          <th>Descrição</th>
          <th>Fornecedor</th>
          <th>Valor</th>
          <th>Vencimento</th>
          <th>Situação</th>
          <th>Ações</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let d of duplicatasDia">
          <td>{{ d.filial }}</td>
          <td>{{ d.descricao }}</td>
          <td>{{ d.fornecedor }}</td>
          <td>{{ d.valorFormatado || (d.valor | number:'1.2-2') }}</td>
          <td>{{ d.dtVendimentoFormatada || (d.dtVencimento | date:'dd/MM/yyyy') }}</td>
          <td>{{ d.situacao }}</td>

          <td>
            <!-- NÃO prevista -->
            <button *ngIf="!d.prevista"
                    type="button"
                    class="btn-baixar"
                    (click)="abrirBaixa(d)">
              Baixar
            </button>

            <!-- PREVISTA -->
            <ng-container *ngIf="d.prevista">
              <div class="acoes-prevista">
                <button type="button"
                        class="btn-excluir"
                        (click)="confirmarExclusaoParcela(d)">
                  <i class="fa-solid fa-trash"></i>
                </button>

                <button type="button"
                        class="btn-converter"
                        title="Converte a parcela prevista em duplicata"
                        (click)="confirmarConversaoParcela(d)">
                  <i class="fa-solid fa-rotate"></i>
                </button>
              </div>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!carregandoDia && duplicatasDia.length === 0" class="mensagem-vazia">
      Nenhuma duplicata encontrada para hoje.
    </div>
  </div>

  <h2>Contas a pagar Vencidas</h2>
  <div class="table-wrapper">
    <div *ngIf="carregandoVencidas" class="carregando">Carregando...</div>

    <table *ngIf="!carregandoVencidas && duplicatasVencidas.length > 0" class="tabela-vencidas">
      <thead>
        <tr>
          <th>Filial</th>
          <th>Descrição</th>
          <th>Fornecedor</th>
          <th>Valor</th>
          <th>Vencimento</th>
          <th>Situação</th>
          <th>Ações</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let d of duplicatasVencidas">
          <td>{{ d.filial }}</td>
          <td>{{ d.descricao }}</td>
          <td>{{ d.fornecedor }}</td>
          <td>{{ d.valorFormatado || (d.valor | number:'1.2-2') }}</td>
          <td>{{ d.dtVendimentoFormatada || (d.dtVencimento | date:'dd/MM/yyyy') }}</td>
          <td>{{ d.situacao }}</td>

          <td>
            <button *ngIf="!d.prevista"
                    type="button"
                    class="btn-baixar"
                    (click)="abrirBaixa(d)">
              Baixar
            </button>

            <ng-container *ngIf="d.prevista">
              <div class="acoes-prevista">
                <button type="button"
                        class="btn-excluir"
                        (click)="confirmarExclusaoParcela(d)">
                  <i class="fa-solid fa-trash"></i>
                </button>

                <button type="button"
                        class="btn-converter"
                        title="Converte a parcela prevista em duplicata"
                        (click)="confirmarConversaoParcela(d)">
                  <i class="fa-solid fa-rotate"></i>
                </button>
              </div>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!carregandoVencidas && duplicatasVencidas.length === 0" class="mensagem-vazia">
      Nenhuma duplicata vencida.
    </div>
  </div>
  <div class="modal-backdrop" *ngIf="duplicataSelecionada">
    <div class="modal">
      <h3>Baixar Parcela - {{ duplicataSelecionada.descricao }}</h3>
      <app-baixar-parcela [duplicataSelecionada]="duplicataSelecionada"></app-baixar-parcela>
      <button type="button" (click)="fecharBaixa()">Fechar</button>
    </div>
  </div>

  <div *ngIf="erroMsg" class="erro-msg">{{ erroMsg }}</div>
</div>
