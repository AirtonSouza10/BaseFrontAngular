<div class="relatorio-dia">

  <!-- Cabeçalho -->
  <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
    <h2>Parcelas Ativas</h2>
  </div>

  <!-- Campo de busca -->
  <div class="input-pesquisa">
    <input type="text" [(ngModel)]="termo" placeholder="Número parcela, duplicata, fornecedor..." />
    <button (click)="pesquisar()">Buscar</button>
  </div>

  <!-- Mensagem quando não encontrado -->
  <div *ngIf="pesquisado && resultados.length === 0" class="mensagem-vazia">
    Nenhuma parcela encontrada.
  </div>

  <!-- Container da tabela -->
  <div class="table-container" *ngIf="resultados.length > 0">
    <table>
      <thead>
        <tr>
          <th>ID Parcela</th>
          <th>Parcela</th>
          <th>Duplicata</th>
          <th>Fornecedor</th>
          <th>Valor</th>
          <th>Vencimento</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of resultados">
          <td data-label="ID Parcela">{{ p.parcelaId }}</td>
          <td data-label="Parcela">{{ p.numeroParcela || '—' }}</td>
          <td data-label="Duplicata">{{ p.descricaoDuplicata }}</td>
          <td data-label="Fornecedor">{{ p.fornecedorNome }}</td>
          <td data-label="Valor">{{ p.valorTotal | currency:'BRL' }}</td>
          <td data-label="Vencimento">{{ p.dtVencimento | date:'dd/MM/yyyy' }}</td>
          <td data-label="Status">{{ p.status || '—' }}</td>
          <td data-label="Ações">
            <button class="btn-baixar" (click)="abrirBaixa(p)">Baixar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginação -->
  <div class="paginacao" *ngIf="totalPages > 1">
    <button (click)="paginaAnterior()" [disabled]="pagina === 0">«</button>

    <button *ngIf="getPaginasVisiveis()[0] > 0" (click)="irParaPagina(0)">1</button>
    <span *ngIf="getPaginasVisiveis()[0] > 1">...</span>

    <button *ngFor="let p of getPaginasVisiveis()"
            (click)="irParaPagina(p)"
            [class.active]="p === pagina">{{ p + 1 }}</button>

    <span *ngIf="getPaginasVisiveis()[getPaginasVisiveis().length - 1] < totalPages - 2">...</span>
    <button *ngIf="getPaginasVisiveis()[getPaginasVisiveis().length - 1] < totalPages - 1"
            (click)="irParaPagina(totalPages - 1)">{{ totalPages }}</button>

    <button (click)="proximaPagina()" [disabled]="pagina === totalPages - 1">»</button>
  </div>

  <!-- MODAL BAIXAR PARCELA -->
  <div class="modal-backdrop" *ngIf="parcelaSelecionada">
    <div class="modal">
      <h3>Baixar Parcela - {{ parcelaSelecionada.descricaoDuplicata }}</h3>
      <app-baixar-parcela [duplicataSelecionada]="parcelaSelecionada"></app-baixar-parcela>
      <button (click)="fecharBaixa()">Fechar</button>
    </div>
  </div>

</div>
