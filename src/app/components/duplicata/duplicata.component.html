<div class="form-container">
  <h2>Conta a pagar</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <!-- DADOS DA DUPLICATA -->
    <div class="form-section">
      <h3>Dados da conta a pagar</h3>

      <div class="form-row">
        <div class="form-group flex-2">
          <label>Descrição</label>
          <input type="text" formControlName="descricao" required />
        </div>
        <div class="form-group flex-1">
          <label>Valor</label>
          <input type="text" formControlName="valor" step="0.01" currencyMask [options]="currencyOptions" />
        </div>
        <div class="form-group flex-1">
          <label>Desconto</label>
          <input type="text" formControlName="desconto" step="0.01" currencyMask [options]="currencyOptions" />
        </div>
        <div class="form-group flex-1">
          <label>Multa</label>
          <input type="text" formControlName="multa" step="0.01" currencyMask [options]="currencyOptions" />
        </div>
        <div class="form-group flex-1">
          <label>Juros</label>
          <input type="text" formControlName="juros" step="0.01" currencyMask [options]="currencyOptions" />
        </div>
        <div class="form-group flex-1">
          <label>Valor Total</label>
          <input type="text" formControlName="valorTotal" step="0.01" currencyMask [options]="currencyOptions" readonly />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group flex-2">
          <label>Forma de Pagamento</label>
          <select formControlName="formaPagamentoId" (change)="onFormaPagamentoChange($any($event.target).value)">
            <option [ngValue]="null">Selecione</option>
            <option *ngFor="let f of formasPagamento" [ngValue]="f.id">{{ f.descricao }}</option>
          </select>
        </div>
        <div class="form-group flex-1">
          <label>Quantidade de Parcelas</label>
          <input type="number" formControlName="quantidadeParcelas" readonly />
        </div>
        <div class="form-group flex-1">
          <label>Data Primeira Parcela</label>
          <input type="date" formControlName="dtPrimeiraParcela" />
        </div>
        <div class="form-group flex-1">
          <label>Intervalo (dias)</label>
          <input type="number" formControlName="intervaloDias" readonly />
        </div>
      </div>
    </div>

    <!-- PARCELAS -->
    <div class="form-section" *ngIf="parcelas.length > 0">
      <h3>Parcelas</h3>
      <div formArrayName="parcelas" class="parcelas-grid">
        <div *ngFor="let parc of parcelas.controls; let i=index" [formGroupName]="i" class="parcela-card">
          <div class="parcela-header">Parcela {{ i + 1 }} / {{ parcelas.length }}</div>
          <div class="form-row">
            <div class="form-group flex-2">
              <label>Data Vencimento</label>
              <input type="date" formControlName="dtVencimento" />
            </div>
            <div class="form-group flex-2">
              <label>Valor</label>
              <input type="text" formControlName="valorTotal" step="0.01" currencyMask [options]="currencyOptions" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AÇÕES -->
    <div class="form-actions">
      <button type="submit" class="btn-submit">{{ editando ? 'Atualizar' : 'Salvar' }}</button>
      <button *ngIf="editando" type="button" class="btn-remove" (click)="cancelarEdicao()">Cancelar</button>
    </div>
  </form>

  <!-- TABELA DE DUPLICATAS SALVAS -->
  <table class="tabela-tipos" *ngIf="duplicatas.length">
    <thead>
      <tr>
        <th>Descrição</th>
        <th>Valor Total</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let d of duplicatas">
        <td>{{ d.descricao }}</td>
        <td>{{ d.valorTotal | currency:'BRL' }}</td>
        <td>
          <div class="acoes-tabela">
            <button type="button" class="btn-submit" (click)="editarDuplicata(d)">Editar</button>
            <button type="button" class="btn-remove" (click)="excluirDuplicata(d.id)">Excluir</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>
