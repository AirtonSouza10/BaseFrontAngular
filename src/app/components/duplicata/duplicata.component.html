<div class="form-container">
  <h2>Duplicata</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">

    <!-- DADOS DA DUPLICATA -->
    <div class="form-section">
      <h3>Dados da Duplicata</h3>

      <div class="form-row">
        <div class="form-group flex-3">
          <label>Descrição</label>
          <input type="text" formControlName="descricao" required />
        </div>
        <div class="form-group flex-1">
          <label>Valor</label>
          <input type="number" formControlName="valor" step="0.01" />
        </div>
        <div class="form-group flex-1">
          <label>Desconto</label>
          <input type="number" formControlName="desconto" step="0.01" />
        </div>
        <div class="form-group flex-1">
          <label>Multa</label>
          <input type="number" formControlName="multa" step="0.01" />
        </div>
        <div class="form-group flex-1">
          <label>Juros</label>
          <input type="number" formControlName="juros" step="0.01" />
        </div>
        <div class="form-group flex-1">
          <label>Valor Total</label>
          <input type="number" formControlName="valorTotal" readonly />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group flex-1">
          <label>Quantidade de Parcelas</label>
          <input type="number" min="1" formControlName="quantidadeParcelas" />
        </div>
        <div class="form-group flex-1">
          <label>Data Primeira Parcela</label>
          <input type="date" formControlName="dtPrimeiraParcela" />
        </div>
        <div class="form-group flex-1">
          <label>Intervalo (dias)</label>
          <input type="number" min="1" formControlName="intervaloDias" />
        </div>
        <div class="form-group flex-1 flex-button">
          <button type="button" class="btn-add" (click)="gerarParcelas()">Gerar Parcelas</button>
        </div>
      </div>
    </div>

    <!-- PARCELAS -->
    <div class="form-section">
      <h3>Parcelas</h3>
      <div formArrayName="parcelas" class="parcelas-grid">
        <div *ngFor="let parc of parcelas.controls; let i=index" [formGroupName]="i" class="parcela-card">
          <div class="parcela-header">Parcela {{ i + 1 }} / {{ parcelas.length }}</div>
          <div class="form-row">
            <div class="form-group flex-2">
              <label>Data Vencimento</label>
              <input type="date" formControlName="dtVencimento" />
            </div>
            <div class="form-group flex-2">
              <label>Valor</label>
              <input type="number" step="0.01" formControlName="valorTotal" readonly />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AÇÕES -->
    <div class="form-actions">
      <button type="submit" class="btn-submit">{{ editando ? 'Atualizar' : 'Salvar' }}</button>
      <button *ngIf="editando" type="button" class="btn-remove" (click)="cancelarEdicao()">Cancelar</button>
    </div>
  </form>

  <!-- MENSAGENS -->
  <div *ngIf="sucessoMsg" class="mensagem-sucesso">{{ sucessoMsg }}</div>
  <div *ngIf="erroMsg" class="mensagem-erro">{{ erroMsg }}</div>

  <!-- TABELA -->
  <table class="tabela-tipos" *ngIf="duplicatas.length">
    <thead>
      <tr>
        <th>Descrição</th>
        <th>Valor Total</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let d of duplicatas">
        <td>{{ d.descricao }}</td>
        <td>{{ d.valorTotal | currency:'BRL' }}</td>
        <td>
          <div class="acoes-tabela">
            <button type="button" class="btn-submit" (click)="editarDuplicata(d)">Editar</button>
            <button type="button" class="btn-remove" (click)="excluirDuplicata(d.id)">Excluir</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>
